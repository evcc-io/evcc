template: e3dc-rscp
products:
  - brand: E3/DC
capabilities: ["battery-control"]
requirements:
  description:
    de: |
      Die Kommunikation erfolgt lokal. evcc muss im selben Netzwerk wie das Hauskraftwerk sein.

      **Achtung**: Die aktive Batteriesteuerung überschreibt Einstellungen im Smart-Power/Betriebsbereich.
    en: |
      The communication is done locally. evcc must be in the same network as the E3/DC system.

      **Note**: Active battery control will override Smart-Power/Operating Range settings.
params:
  - name: usage
    choice: ["grid", "pv", "battery"]
  - name: host
  - name: port
    default: 5033
  - name: user
    required: true
    help:
      en: Identical with Web Portal or E3/DC App.
      de: Identisch mit Web-Portal bzw. E3/DC App.
  - name: password
    help:
      en: Identical with Web Portal or E3/DC App.
      de: Identisch mit Web-Portal bzw. E3/DC App.
    required: true
  - name: key
    description:
      en: RSCP password
      de: RSCP-Passwort
    help:
      en: Must be set on the screen of your E3/DC system at 'Personalize' > 'User Profile'.
      de: Muss auf dem Bildschirm des Hauskraftwerks unter 'Personalisieren' > 'Benutzerprofil' angelegt werden.
    mask: true
    required: true
  - name: battery
    description:
      generic: Battery
    deprecated: true
  - name: dischargelimit
    description:
      de: Entladelimit in W
      en: Discharge limit in W
    help:
      de: Limitiert die Entladeleistung im 'Halten' Batteriemodus
      en: Limits discharge power in 'Hold' battery mode
    type: int
    advanced: true
    usages: ["battery"]
  - name: maxacpower
  - name: capacity
    advanced: true
  - name: externalpower
    type: bool
    description:
      de: Externe Quelle einschließen
      en: Include external power
    help:
      de: Bezieht alle angeschlossenen externen Quellen in die PV-Berechnung ein (Standard).
      en: Includes all connected external sources into the PV calculation (default).
    advanced: true
    usages: ["pv"]
    default: "true"
render: |
  type: e3dc-rscp
  usage: {{ .usage }}
  uri: {{ .host }}:{{ .port }}
  user: {{ .user }}
  password: {{ .password }}
  key: {{ .key }}
  {{- if eq .usage "battery" }}
  dischargelimit: {{ .dischargelimit }}
  capacity: {{ .capacity }} # kWh
  {{- end }}
  {{- if eq .usage "pv" }}
  maxacpower: {{ .maxacpower }} # W
  externalpower: {{ .externalpower }}
  {{- end }}
