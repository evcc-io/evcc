template: e3dc-rscp
products:
  - brand: E3/DC
capabilities: ["battery-control"]
requirements:
  description:
    de: |
      Die Zugangsdaten werden im Hauskraftwerk unter Personalisieren/Benutzerprofil angelegt. Die IP-Adressen von evcc und des Hauskraftwerks müssen sich im selben Subnetz befinden.

      **Achtung**: Die aktive Batteriesteuerung überschreibt Einstellungen im Smart-Power/Betriebsbereich.
    en: |
      The access data is created in the home power plant under Personalize/User Profile. The IP addresses of evcc and the home power plant must be in the same subnet.

      **Note**: Active battery control will override Smart-Power/Operating Range settings.
params:
  - name: usage
    choice: ["grid", "pv", "battery"]
    allinone: true
  - name: host
  - name: port
    default: 5033
  - name: user
    required: true
    default: local.user
    help:
      de: Offline RSCP-Nutzer (local.user). Alternativ der Benutzername vom Web-Portal bzw. My E3/DC App. Alternatively die E-Mail-Adresse des E3/DC-Kontos,
      en: Offline RSCP user (local.user). Alternatively the username from Web Portal or My E3/DC App. Alternatively the email address of the E3/DC account
  - name: password
    required: true
    help:
      de: Passwort für den offline RSCP-Nutzer (local.user). Alternantiv das Passwort vom Web-Portal bzw. My E3/DC App
      en: Password for offline RSCP user (local.user). Alternatively the password from Web Portal or My E3/DC App      
  - name: useinternalpower
    description:
      de: Interne Erzeugung auslesen
      en: Read internal generation
    help:
      de: Lese die Leistung vom internen Wechselrichter aus
      en: Reads the power from the internal inverter
    default: true
    type: bool
    advanced: true
    usages: ["pv"]
  - name: useexternalpower
    description:
      de: Externe Erzeugung auslesen
      en: Read external generation
    help:
      de: Liest die Leistung am externen Leistungsmesser aus und addiert diese zur internen Erzeugung
      en: Reads the power from the external power meter and adds it to the internal generation
    default: true
    type: bool
    advanced: true
    usages: ["pv"]
  - name: key
    description:
      de: RSCP-Passwort
      en: RSCP-Password
    help:
      de: Das RSCP-Passwort wird im Hauskraftwerk unter Personalisieren/Sicherheit gesetzt.
      en: The RSCP password is set in the home power plant under Personalize/Security.
    default: local.rscp
    required: true
  - name: battery
    description:
      de: Batterie
      en: Battery
    deprecated: true
  - name: dischargelimit
    description:
      de: Entladelimit in W
      en: Discharge limit in W
    help:
      de: Limitiert die Entladeleistung im 'Halten' Batteriemodus
      en: Limits discharge power in 'Hold' battery mode
    type: int
    advanced: true
    usages: ["battery"]
  - name: maxacpower
  - name: capacity
    advanced: true
    usages: ["battery"]
render: |
  type: e3dc-rscp
  usage: {{ .usage }}
  uri: {{ .host }}:{{ .port }}
  user: {{ .user }}
  password: {{ .password }}
  key: {{ .key }}
  {{- if eq .usage "battery" }}
  dischargelimit: {{ .dischargelimit }}
  capacity: {{ .capacity }} # kWh
  {{- end }}
  {{- if eq .usage "pv" }}
  useinternalpower: {{ .useinternalpower }}
  useexternalpower: {{ .useexternalpower }}
  {{- end }}
