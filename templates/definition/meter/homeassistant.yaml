template: homeassistant
products:
  - brand: Home Assistant
    description:
      de: Home Assistant Sensor
      en: Home Assistant Sensor
group: generic
requirements:
  description:
    en: Home Assistant instance with API access
    de: Home Assistant Instanz mit API-Zugriff
params:
  - name: usage
    choice: ["grid", "pv", "battery", "aux", "charge"]
    help:
      en: "Meter usage type: 'grid' for main grid connection, 'pv' for solar panels, 'battery' for battery storage, 'aux' for auxiliary loads, 'charge' for EV charging point"
      de: "Zählerverwendung: 'grid' für Netzanschluss, 'pv' für Solaranlage, 'battery' für Batteriespeicher, 'aux' für zusätzliche Verbraucher, 'charge' für Ladestation"
  - name: uri
    description:
      de: Home Assistant URL
      en: Home Assistant URL
    required: true
    example: "http://homeassistant.local:8123"
    help:
      en: Base URL of your Home Assistant instance
      de: Basis-URL Ihrer Home Assistant Instanz
  - name: token
    description:
      de: Access Token
      en: Access Token
    required: true
    mask: true
    help:
      en: Long-lived access token for Home Assistant API
      de: Dauerhafter Zugangstoken für die Home Assistant API
  - name: power
    description:
      de: Leistung Entity
      en: Power Entity
    required: true
    example: "sensor.house_power"
    help:
      en: Entity ID for instantaneous power measurement in watts. The entity must provide numeric values only (e.g., "1234", not "1234 W").
      de: Entitäts-ID für momentane Leistungsmessung in Watt. Die Entität muss nur numerische Werte liefern (z.B. "1234", nicht "1234 W").
  - name: energy
    description:
      de: Energie Entity
      en: Energy Entity
    example: "sensor.house_energy"
    advanced: true
    help:
      en: Entity ID for cumulative energy measurement in kWh (optional). Should provide total energy consumed/produced, not daily or interval values.
      de: Entitäts-ID für kumulative Energiemessung in kWh (optional). Sollte die gesamte verbrauchte/produzierte Energie liefern, nicht tägliche oder Intervallwerte.
  - name: currentL1
    description:
      de: L1 Strom Entity
      en: L1 Current Entity
    example: "sensor.house_current_l1"
    advanced: true
    help:
      en: Entity ID for L1 current measurement in amperes (optional)
      de: Entitäts-ID für L1 Strommessung in Ampere (optional)
  - name: currentL2
    description:
      de: L2 Strom Entity
      en: L2 Current Entity
    example: "sensor.house_current_l2"
    advanced: true
    help:
      en: Entity ID for L2 current measurement in amperes (optional)
      de: Entitäts-ID für L2 Strommessung in Ampere (optional)
  - name: currentL3
    description:
      de: L3 Strom Entity
      en: L3 Current Entity
    example: "sensor.house_current_l3"
    advanced: true
    help:
      en: Entity ID for L3 current measurement in amperes (optional)
      de: Entitäts-ID für L3 Strommessung in Ampere (optional)
  - name: voltageL1
    description:
      de: L1 Spannung Entity
      en: L1 Voltage Entity
    example: "sensor.house_voltage_l1"
    advanced: true
    help:
      en: Entity ID for L1 voltage measurement in volts (optional)
      de: Entitäts-ID für L1 Spannungsmessung in Volt (optional)
  - name: voltageL2
    description:
      de: L2 Spannung Entity
      en: L2 Voltage Entity
    example: "sensor.house_voltage_l2"
    advanced: true
    help:
      en: Entity ID for L2 voltage measurement in volts (optional)
      de: Entitäts-ID für L2 Spannungsmessung in Volt (optional)
  - name: voltageL3
    description:
      de: L3 Spannung Entity
      en: L3 Voltage Entity
    example: "sensor.house_voltage_l3"
    advanced: true
    help:
      en: Entity ID for L3 voltage measurement in volts (optional)
      de: Entitäts-ID für L3 Spannungsmessung in Volt (optional)
render: |
  type: homeassistant
  uri: {{ .uri }}
  token: {{ .token }}
  power: {{ .power }}
  {{- if .energy }}
  energy: {{ .energy }}
  {{- end }}
  {{- if and .currentL1 .currentL2 .currentL3 }}
  currents:
  {{- if .currentL1 }}
    - {{ .currentL1 }}
  {{- end }}
  {{- if .currentL2 }}
    - {{ .currentL2 }}
  {{- end }}
  {{- if .currentL3 }}
    - {{ .currentL3 }}
  {{- end }}
  {{- end }}
  {{- if or .voltageL1 .voltageL2 .voltageL3 }}
  voltages:
  {{- if .voltageL1 }}
    - {{ .voltageL1 }}
  {{- end }}
  {{- if .voltageL2 }}
    - {{ .voltageL2 }}
  {{- end }}
  {{- if .voltageL3 }}
    - {{ .voltageL3 }}
  {{- end }}
  {{- end }}
