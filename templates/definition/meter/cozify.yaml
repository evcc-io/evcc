template: cozify
products:
  - brand: Cozify HAN
    description:
      generic: Cozify HAN
requirements:
  description:
    de: Erfordert eine Verbindung zum Cozify HAN Gateway.
    en: Requires a connection to the Cozify HAN gateway.
params:
  - name: usage
    choice: ["grid"]
  - name: host
    required: true
  - name: timeout
    default: 2s
render: |
  type: custom
  power:
    source: http
    uri: http://{{ .host }}/meter/data
    jq: (.pi[0] - .pe[0])
    timeout: {{ .timeout }}
  energy:
    source: http
    uri: http://{{ .host }}/meter/data
    jq:  (.ic | tonumber)
    timeout: {{ .timeout }}
  currents:
    - source: http
      uri: http://{{ .host }}/meter/data
      jq: .i[0]
      timeout: {{ .timeout }}
    - source: http
      uri: http://{{ .host }}/meter/data
      jq: .i[1]
      timeout: {{ .timeout }}
    - source: http
      uri: http://{{ .host }}/meter/data
      jq: .i[2]
      timeout: {{ .timeout }}
  voltages:
    - source: http
      uri: http://{{ .host }}/meter/data
      jq: .u[0]
      timeout: {{ .timeout }}
    - source: http
      uri: http://{{ .host }}/meter/data
      jq: .u[1]
      timeout: {{ .timeout }}
    - source: http
      uri: http://{{ .host }}/meter/data
      jq: .u[2]
      timeout: {{ .timeout }}
