template: youless
products:
  - brand: Youless
    description:
      generic: Energy Monitor
requirements:
  description:
    de: |
      Zur Erfassung der PV-Produktion wird ein extern angebundenener S0-Erzeugungszähler benötigt.
    en: |
      An externally connected S0 generation meter is required to record the solar production.
params:
  - name: usage
    choice: ["grid", "pv"]
  - name: host
render: |
  type: custom
  {{- if eq .usage "grid" }}
  power:
    source: http
    uri: http://{{ .host }}/e
    jq: .[0]|.pwr
  energy:
    source: http
    uri: http://{{ .host }}/e
    jq: .[0]|.p1+.p2
  currents:
  - source: http
    uri: http://{{ .host }}/f
    jq: (.i1 * (if .l1 < 0 then -1 else 1 end)) # Invert the sign of i1 if l1 is negative to reflect direction
  - source: http
    uri: http://{{ .host }}/f
    jq: (.i2 * (if .l2 < 0 then -1 else 1 end))
  - source: http
    uri: http://{{ .host }}/f
    jq: (.i3 * (if .l3 < 0 then -1 else 1 end))
  {{- end }}
  {{- if eq .usage "pv" }}
  power:
    source: http
    uri: http://{{ .host }}/e
    jq: .[0].ps0
  energy:
    source: http
    uri: http://{{ .host }}/e
    jq: .[0].cs0
  {{- end }}
