template: test-solar-forecast-static
group: solar
products:
  - brand: Test
    description:
      de: Statische Solarvorhersage
      en: Static solar forecast
requirements:
  description:
    en: For testing purposes. Provides constant solar production 24/7.
    de: Zu Testzwecken. Liefert konstante Solarproduktion rund um die Uhr.
params:
  - name: power
    description:
      de: Konstante Solarleistung
      en: Constant solar power
    type: float
    unit: W
    default: 2000
    help:
      de: Konstante Solarleistung in Watt
      en: Constant solar power in watts
  - name: interval
    default: 1h
    advanced: true

render: |
  type: custom
  tariff: solar
  forecast:
    source: js
    script: |
      // Generate static solar forecast for next 48 hours
      var now = new Date();
      var start = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);
      var rates = [];
      var constantPower = {{ .power }};

      for (var day = 0; day < 2; day++) {
        for (var hour = 0; hour < 24; hour++) {
          var time = new Date(start.getTime() + (day * 24 + hour) * 60 * 60 * 1000);
          var nextTime = new Date(time.getTime() + 60 * 60 * 1000);

          rates.push({
            start: time.toISOString(),
            end: nextTime.toISOString(),
            value: constantPower
          });
        }
      }

      JSON.stringify(rates);
  interval: {{ .interval }}