template: lg-therma
products:
  - brand: LG
    description:
      generic: Therma V R290 Monobloc (SG Ready)
group: heating
requirements:
  description:
    de: |
      Modbus Verbindung zur LG Therma V Wärmepumpe.
      Funktioniert über SG Ready Energiezustände für intelligente Steuerung.
      Inneneinheit/Fernbedienung in den erweiterten Einstellungen > "Konnektivität" > "Energiezustand" > "Signaltyp" > auf "Modbus" einstellen.
      Da die interne Energiemessung zu hohe Werte anzeigt ist eine externe Energiemessung empfohlen.
      Werkseinstellung Modbus Addresse(HEX) = 21 (33).
      Modbus Register sind im Installationshandbuch zu finden (Adresse jeweils ohne die führende Ziffer und -1).
      Informationen zu den Energiezuständen finden sich auch im Installationshandbuch.
      Die Energiezustände 6 und 7 können an der Inneneinheit in den erweiterten Einstellungen > "Konnektivität" > "Energiezustand" > "Definition der Energiezustände" angepasst werden.
    en: |
      Modbus connection to LG Therma V heat pump.
      Uses SG Ready energy states for intelligent control.
      Set the indoor unit in the installer settings > "Connectivity" > "Energy state" > "ESS use type" > to "Modbus".
      Since the internal power measurement shows to high values, an external power measurement is suggested.
      Factory setting Modbus (HEX) = 21 (33).
      Modbus registers can be found within the installation manual (address without the leading number and -1).
      Information on the energy state can be found within the installation manual. 
params:
  - name: modbus
    choice: ["rs485"]
    id: 33
  - name: tempsource
    required: true
    type: choice
    choice: ["warmwater", "flow_temperature"]
render: |
  type: sgready
  setmode:
    source: map
    values:
      1: 7 # Energiesparen
      2: 2 # Normalbetrieb
      3: 6 # Boost
    set:
      source: modbus
      {{- include "modbus" . | indent 4 }}
      register:
        address: 9
        type: writeholdings
        encoding: uint16
  getmode:
    source: map
    values:
      7: 1 # Energiesparen
      2: 2 # Normalbetrieb
      6: 3 # Boost
    get:
      source: modbus
      {{- include "modbus" . | indent 4 }}
      register:
        address: 9
        type: holding
        encoding: uint16        
  temp:
    source: modbus
    {{- include "modbus" . | indent 2 }}
    scale: 0.1
    register:
      address:  {{ if eq .tempsource "warmwater" -}} 5 {{ else }} 2 {{- end }} # 5 Trinkwasser, 2 Wassereinlasstemperatur
      type: input
      decode: uint16
  power:
    source: modbus
    {{- include "modbus" . | indent 2 }}
    register:
      address: 35
      type: input
      decode: uint16
