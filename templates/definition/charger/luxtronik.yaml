template: luxtronik
products:
  - brand: Buderus (Logamatic HMC20, HMC20 Z) 
    description:
      generic: Luxtronik 2.1
  - brand: alpha innotec
    description:
      generic: Luxtronik 2.1
  - brand: CTA All-In-One (Aeroplus)
    description:
      generic: Luxtronik 2.1
  - brand: Elco
    description:
      generic: Luxtronik 2.1
  - brand: Nibe (AP-AW10)
    description:
      generic: Luxtronik 2.1
  - brand: Roth (ThermoAura, ThermoTerra)
    description:
      generic: Luxtronik 2.1
  - brand: Novelan (WPR NET)
    description:
      generic: Luxtronik 2.1
  - brand: Wolf (BWL/BWS)
    description:
      generic: Luxtronik 2.1
group: heating
requirements:
  description:
    de: EnWG 14a Regelung für Wärmepumpe mit Luxtronik 2.1 Steuerung (modbus tcp). Braucht Software >= v3.90.3. Aktivierung über SERVICE --> Systemsteuerung --> Konnektivität --> Smart-Home-Interface. SmartGrid (SGReady) sollte ausgeschaltet sein. Details https://github.com/raibisch/mylibs/blob/main/LuxModbusSHI/LuxtronikSHI.md und Seite 39 https://files.ait-group.net/FILES/Alpha-InnoTec/Betriebsanleitungen/01%20Waermepumpen/05%20Regler/LUX/83055400nDE_Lux_21_Teil_2.pdf
    en: Uses modbus tcp. Requires Software >= v3.90.3. Enable via SERVICE --> Systemsteuerung --> Konnektivität --> Smart-Home-Interface. 
#   evcc: ["sponsorship"]
params:
  - name: modbus
    choice: ["tcpip"]
  - name: tempsource
    type: ["warmwater"]
render: |
  type: sgready
  getmode:
    source: map
    values:
      0: 2 # Lux No-Limit (0) --> SG Ready Normal (2)
      1: 1 # Lux Soft-Limit (1) --> SG Ready reduzierte Leistung (1)
      2: 1 # Lux Hard-Limit (2) --> SG Ready reduzierte Leistung (1)
    get:
      source: modbus
      {{- include "modbus" . | indent 4 }}
      register:
        address: 100040
        type: input
        encoding: uint16
  setmode:
    source: switch
    switch:
    - case: 1 # dimm (reduzierte Leistung)
      set:
      - source: const
        value: 2 # Lux Hard-Limit (2)
        set:
          source: modbus
          {{- include "modbus" . | indent 8 }}
          register:
            address: 100040 # LPC mode
            type: writesingle
            encoding: uint16
    - case: 2 # normal
      set:
      - source: const
        value: 0 # Lux No-Limit (0)
        set:
          source: modbus
          {{- include "modbus" . | indent 8 }}
          register:
            address: 100040 # LPC mode
            type: writesingle
            encoding: uint16
    - case: 3 # boost
      set:
      - source: const
        value: 0 # Lux No-Limit (0)
        set:
          source: modbus
          {{- include "modbus" . | indent 8 }}
          register:
            address: 100040 # LPC mode
            type: writesingle
            encoding: uint16
  temp:
    source: modbus
    {{- include "modbus" . | indent 2 }}
    register:
      address: 10120 # 10120 = Warmwasser ist
      type: input
      encoding: int16
    scale: 0.1
  power:
    source: modbus
    {{- include "modbus" . | indent 2 }}
    register:
      address: 10301 # kW x10 Power-In elektrisch
      type: input
      encoding: int16
    scale: 0.1
