template: mg2mqtt
products:
  - description:
      generic: mg2mqtt
group: generic
requirements:
  description:
    en: Required MQTT broker configuration and a SAIC/MQTT Gateway (https://github.com/SAIC-iSmart-API/saic-python-mqtt-gateway or https://github.com/SAIC-iSmart-API/saic-java-client)
    de: Voraussetzung ist ein konfigurierter MQTT Broker und ein SAIC/MQTT Gateway (https://github.com/SAIC-iSmart-API/saic-python-mqtt-gateway oder https://github.com/SAIC-iSmart-API/saic-java-client)
params:
  - preset: mqtt
  - name: user
    required: true
  - name: vin
    required: true
  - preset: vehicle-common
  - name: timeout
    default: 1h
render: |
  type: custom
  {{- include "vehicle-common" . }}
  soc: # battery soc (%)
    source: mqtt
    {{- include "mqtt" . | indent 2 }}
    topic: saic/{{ .user }}/vehicles/{{ .vin }}/drivetrain/soc
  status:
    source: combined
    plugged:
      source: mqtt
      {{- include "mqtt" . | indent 4 }}
      topic: saic/{{ .user }}/vehicles/{{ .vin }}/drivetrain/chargerConnected
    charging:
      source: mqtt
      {{- include "mqtt" . | indent 4 }}
      topic: saic/{{ .user }}/vehicles/{{ .vin }}/drivetrain/charging
  range:
    source: mqtt
    {{- include "mqtt" . | indent 2 }}
    topic: saic/{{ .user }}/vehicles/{{ .vin }}/drivetrain/range
  climater:
    source: go
    script: |
      remoteClimateState != "off"
    in:
      - name: remoteClimateState
        type: string
        config:
          source: mqtt
          {{- include "mqtt" . | indent 8 }}
          topic: saic/{{ .user }}/vehicles/{{ .vin }}/climate/remoteClimateState
  odometer:
    source: mqtt
    {{- include "mqtt" . | indent 2 }}
    topic: saic/{{ .user }}/vehicles/{{ .vin }}/drivetrain/mileage
  wakeup:
    source: go
    script: |
      "force"
    out:
      - name: wakeUp
        type: string
        config:
          source: mqtt
          {{- include "mqtt" . | indent 8 }}
          topic: saic/{{ .user }}/vehicles/{{ .vin }}/refresh/mode/set
